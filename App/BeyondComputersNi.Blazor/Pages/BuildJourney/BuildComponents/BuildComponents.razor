@using BeyondComputersNi.Blazor.Pages.BuildJourney.BuildSkeleton
@using BeyondComputersNi.Blazor.Pages.BuildJourney.BuildTimeline

@attribute [Route(PageUrl)]
@inherits Form

@if (LoadingForm)
{
    <BuildSkeleton />
}
else
{
    <EditForm EditContext="@EditContext" OnValidSubmit="@OnValidSubmit" OnInvalidSubmit="@OnInvalidSubmit">
        <DataAnnotationsValidator />

        <MudGrid Class="mb-6">
            <MudItem md="8">
                <MudPaper Class="mt-8 pa-8" Elevation="3">
                    <MudText Typo="Typo.h2" Align="Align.Center">Build your computer</MudText>
                    <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true">Components</MudText>

                    @if (HasErrors)
                    {
                        <FormValidationErrors />
                    }

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.Motherboard" Label="Motherboard"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.Motherboard), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.Motherboard" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.CPU" Label="CPU"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.CPU), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.CPU" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.CPUCooler" Label="CPU Cooler"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.CPUCooler), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.CPUCooler" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.Memory" Label="Memory"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.Memory), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.Memory" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.Storage" Label="Storage"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.Storage), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.Storage" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.GPU" Label="GPU"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.GPU), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.GPU" />

                    <MudAutocomplete T="string" @bind-Value="@BuildComponentsViewModel!.PSU" Label="PSU"
                                     SearchFunc="(string value) => BuildService!.GetComponentsAsync(nameof(BuildComponentsViewModel.PSU), value)"
                                     ResetValueOnEmptyText="true" CoerceValue="true" For="() => BuildComponentsViewModel!.PSU" />

                    @if (Submitting)
                    {
                        <LoadingSpinner />
                    }

                    <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="mt-6">
                        Save components
                    </MudButton>
                </MudPaper>
            </MudItem>

            <MudItem md="4">
                <BuildTimeline CurrentItem="BuildTimelineItem.Components" />
            </MudItem>
        </MudGrid>
    </EditForm>
}
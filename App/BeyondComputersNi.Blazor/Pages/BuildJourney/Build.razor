@attribute [Route(PageUrl)]

<MudText Typo="Typo.body1" Align="Align.Center" Class="mt-4">Setting up your build...</MudText>

<LoadingSpinner />

@code {
    public const string PageUrl = "/Build";

    [Inject]
    private NavigationManager? NavigationManager { get; set; }

    [Inject]
    private IBuildService? BuildService { get; set; }

    [Inject]
    private ISnackbar? Snackbar { get; set; }

    protected async override Task OnInitializedAsync()
    {
        try
        {
            var id = await BuildService!.CreateBuild();
            if (id == 0) throw new Exception("Error, please try again");

            var componentsUrl = BuildComponents.BuildComponents.PageUrl.Replace("{id:int}", id.ToString());
            NavigationManager?.NavigateTo(componentsUrl);
        }
        catch(Exception ex)
        {
            Snackbar?.Add(ex.Message, Severity.Error);
            NavigationManager?.NavigateTo(Home.Home.PageUrl);
        }
    }
}
